"use strict";(self.webpackChunkprofilebook_frontend=self.webpackChunkprofilebook_frontend||[]).push([[175],{6175:(S,l,a)=>{a.r(l),a.d(l,{GroupChatComponent:()=>T});var m=a(177),g=a(4341),e=a(4438),u=a(2183),c=a(708),p=a(4796);const f=["messagesContainer"];function h(t,r){if(1&t&&(e.j41(0,"small"),e.EFF(1),e.k0s()),2&t){const s=e.XpG();e.R7$(),e.SpI("",s.group.memberCount," members")}}function _(t,r){if(1&t&&(e.j41(0,"div",25)(1,"small",23),e.nrm(2,"i",26),e.EFF(3),e.k0s()()),2&t){const s=e.XpG();e.R7$(3),e.SpI(" ",s.group.description||"No description available"," ")}}function b(t,r){1&t&&(e.j41(0,"div",27)(1,"div",28)(2,"div",29)(3,"span",30),e.EFF(4,"Loading messages..."),e.k0s()(),e.j41(5,"p",31),e.EFF(6,"Loading messages..."),e.k0s()()())}function M(t,r){1&t&&(e.j41(0,"div",35),e.nrm(1,"i",36),e.j41(2,"h6",23),e.EFF(3,"No messages yet"),e.k0s(),e.j41(4,"p",23),e.EFF(5,"Be the first to start the conversation!"),e.k0s()())}function C(t,r){if(1&t&&(e.j41(0,"div",43)(1,"small",44),e.EFF(2),e.k0s()()),2&t){const s=e.XpG().$implicit;e.R7$(2),e.SpI(" ",s.userFullName||s.userName," ")}}function v(t,r){if(1&t&&(e.j41(0,"div",37)(1,"div",38)(2,"div",39),e.DNE(3,C,3,1,"div",40),e.j41(4,"div",41),e.EFF(5),e.k0s(),e.j41(6,"div",42)(7,"small",23),e.EFF(8),e.k0s()()()()()),2&t){const s=r.$implicit,o=e.XpG(2);e.R7$(),e.AVh("justify-content-end",o.isMyMessage(s)),e.R7$(),e.AVh("my-message",o.isMyMessage(s))("other-message",!o.isMyMessage(s)),e.R7$(),e.Y8G("ngIf",!o.isMyMessage(s)),e.R7$(2),e.SpI(" ",s.content," "),e.R7$(3),e.SpI(" ",o.formatMessageTime(s.createdAt)," ")}}function G(t,r){if(1&t&&(e.j41(0,"div",32,0),e.DNE(2,M,6,0,"div",33)(3,v,9,9,"div",34),e.k0s()),2&t){const s=e.XpG();e.R7$(2),e.Y8G("ngIf",0===s.messages.length),e.R7$(),e.Y8G("ngForOf",s.messages)}}function I(t,r){1&t&&e.nrm(0,"span",45)}function y(t,r){1&t&&e.nrm(0,"i",46)}function E(t,r){if(1&t){const s=e.RV6();e.j41(0,"div",47),e.nrm(1,"i",48),e.EFF(2),e.j41(3,"button",49),e.bIt("click",function(){e.eBV(s);const n=e.XpG();return e.Njj(n.errorMessage="")}),e.k0s()()}if(2&t){const s=e.XpG();e.R7$(2),e.SpI("",s.errorMessage," ")}}let T=(()=>{class t{constructor(s,o,n,i){this.route=s,this.router=o,this.userGroupsService=n,this.authService=i,this.group=null,this.messages=[],this.newMessage="",this.currentUserId="",this.isLoadingGroup=!1,this.isLoadingMessages=!1,this.isSending=!1,this.errorMessage="",this.shouldScrollToBottom=!1}ngOnInit(){this.currentUserId=this.authService.getCurrentUserId()||"",this.route.params.subscribe(s=>{this.groupId=+s.id,this.groupId&&(this.loadGroup(),this.loadMessages())})}ngOnDestroy(){}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}loadGroup(){this.isLoadingGroup=!0,this.errorMessage="",this.userGroupsService.getGroup(this.groupId).subscribe({next:s=>{this.group=s,this.isLoadingGroup=!1},error:s=>{this.isLoadingGroup=!1,this.errorMessage=404===s.status?"Group not found or you are not a member of this group.":"Failed to load group information.",console.error("Error loading group:",s)}})}loadMessages(){this.isLoadingMessages=!0,this.errorMessage="",this.userGroupsService.getGroupMessages(this.groupId).subscribe({next:s=>{this.messages=s.reverse(),this.isLoadingMessages=!1,this.shouldScrollToBottom=!0},error:s=>{this.isLoadingMessages=!1,this.errorMessage=403===s.status?"You are not authorized to view messages in this group.":"Failed to load messages.",console.error("Error loading messages:",s)}})}sendMessage(){!this.newMessage.trim()||this.isSending||(this.isSending=!0,this.errorMessage="",this.userGroupsService.sendGroupMessage(this.groupId,this.newMessage.trim()).subscribe({next:s=>{this.messages.push(s),this.newMessage="",this.isSending=!1,this.shouldScrollToBottom=!0},error:s=>{this.isSending=!1,this.errorMessage=403===s.status?"You are not authorized to send messages to this group.":"Failed to send message. Please try again.",console.error("Error sending message:",s)}}))}isMyMessage(s){return s.userId===this.currentUserId}formatMessageTime(s){const o=new Date(s);return((new Date).getTime()-o.getTime())/36e5<24?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):o.toLocaleDateString()+" "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}scrollToBottom(){try{if(this.messagesContainer){const s=this.messagesContainer.nativeElement;s.scrollTop=s.scrollHeight}}catch(s){console.error("Error scrolling to bottom:",s)}}goBack(){this.router.navigate(["/my-groups"])}static{this.\u0275fac=function(o){return new(o||t)(e.rXU(u.nX),e.rXU(u.Ix),e.rXU(c.J),e.rXU(p.u))}}static{this.\u0275cmp=e.VBU({type:t,selectors:[["app-group-chat"]],viewQuery:function(o,n){if(1&o&&e.GBs(f,5),2&o){let i;e.mGM(i=e.lsd())&&(n.messagesContainer=i.first)}},standalone:!0,features:[e.aNF],decls:28,vars:12,consts:[["messagesContainer",""],[1,"container-fluid","mt-3"],[1,"row","justify-content-center"],[1,"col-lg-8","col-md-10"],[1,"card","shadow-sm","h-100"],[1,"card-header","bg-info","text-white","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"fas","fa-comments","me-2"],[4,"ngIf"],[1,"btn","btn-warning","btn-sm",3,"click"],[1,"fas","fa-arrow-left","me-1"],["class","card-body p-2 bg-light border-bottom",4,"ngIf"],[1,"card-body","p-0","position-relative",2,"height","60vh"],["class","d-flex justify-content-center align-items-center h-100",4,"ngIf"],["class","messages-container p-3","style","height: 100%; overflow-y: auto;",4,"ngIf"],[1,"card-footer","bg-white","border-top"],[1,"d-flex","gap-2",3,"ngSubmit"],[1,"flex-grow-1"],["type","text","name","newMessage","placeholder","Type your message...","maxlength","1000","autocomplete","off",1,"form-control",3,"ngModelChange","keydown.enter","ngModel","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],["class","fas fa-paper-plane",4,"ngIf"],[1,"mt-1"],[1,"text-muted"],["class","alert alert-danger m-3 mb-0",4,"ngIf"],[1,"card-body","p-2","bg-light","border-bottom"],[1,"fas","fa-info-circle","me-1"],[1,"d-flex","justify-content-center","align-items-center","h-100"],[1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"messages-container","p-3",2,"height","100%","overflow-y","auto"],["class","text-center py-5",4,"ngIf"],["class","mb-3",4,"ngFor","ngForOf"],[1,"text-center","py-5"],[1,"fas","fa-comment-slash","fa-3x","text-muted","mb-3"],[1,"mb-3"],[1,"d-flex"],[1,"message-bubble",2,"max-width","70%"],["class","message-header mb-1",4,"ngIf"],[1,"message-content"],[1,"message-time","mt-1"],[1,"message-header","mb-1"],[1,"fw-bold","text-primary"],[1,"spinner-border","spinner-border-sm","me-1"],[1,"fas","fa-paper-plane"],[1,"alert","alert-danger","m-3","mb-0"],[1,"fas","fa-exclamation-triangle","me-2"],["type","button",1,"btn-close","float-end",3,"click"]],template:function(o,n){1&o&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div")(6,"h5",6),e.nrm(7,"i",7),e.EFF(8),e.k0s(),e.DNE(9,h,2,1,"small",8),e.k0s(),e.j41(10,"button",9),e.bIt("click",function(){return n.goBack()}),e.nrm(11,"i",10),e.EFF(12,"Back "),e.k0s()(),e.DNE(13,_,4,1,"div",11),e.j41(14,"div",12),e.DNE(15,b,7,0,"div",13)(16,G,4,2,"div",14),e.k0s(),e.j41(17,"div",15)(18,"form",16),e.bIt("ngSubmit",function(){return n.sendMessage()}),e.j41(19,"div",17)(20,"input",18),e.mxI("ngModelChange",function(d){return e.DH7(n.newMessage,d)||(n.newMessage=d),d}),e.bIt("keydown.enter",function(){return n.sendMessage()}),e.k0s()(),e.j41(21,"button",19),e.DNE(22,I,1,0,"span",20)(23,y,1,0,"i",21),e.k0s()(),e.j41(24,"div",22)(25,"small",23),e.EFF(26),e.k0s()()(),e.DNE(27,E,4,1,"div",24),e.k0s()()()()),2&o&&(e.R7$(8),e.SpI("",(null==n.group?null:n.group.groupName)||"Group Chat"," "),e.R7$(),e.Y8G("ngIf",n.group),e.R7$(4),e.Y8G("ngIf",n.group),e.R7$(2),e.Y8G("ngIf",n.isLoadingMessages),e.R7$(),e.Y8G("ngIf",!n.isLoadingMessages),e.R7$(4),e.R50("ngModel",n.newMessage),e.Y8G("disabled",n.isSending),e.R7$(),e.Y8G("disabled",!n.newMessage.trim()||n.isSending),e.R7$(),e.Y8G("ngIf",n.isSending),e.R7$(),e.Y8G("ngIf",!n.isSending),e.R7$(3),e.SpI("",n.newMessage.length,"/1000 characters"),e.R7$(),e.Y8G("ngIf",n.errorMessage))},dependencies:[m.MD,m.Sq,m.bT,g.YN,g.qT,g.me,g.BC,g.cb,g.tU,g.vS,g.cV],styles:[".messages-container[_ngcontent-%COMP%]{background:#f8f9fa}.message-bubble[_ngcontent-%COMP%]{padding:.75rem;border-radius:1rem;word-wrap:break-word}.my-message[_ngcontent-%COMP%]{background:#007bff;color:#fff;border-bottom-right-radius:.25rem}.other-message[_ngcontent-%COMP%]{background:#fff;border:1px solid #dee2e6;border-bottom-left-radius:.25rem}.message-header[_ngcontent-%COMP%]{font-size:.8rem}.message-content[_ngcontent-%COMP%]{line-height:1.4}.message-time[_ngcontent-%COMP%]{font-size:.75rem;opacity:.8}.my-message[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fffc}.card-body[_ngcontent-%COMP%]{padding:0}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding:0 .5rem}.message-bubble[_ngcontent-%COMP%]{max-width:85%!important}}"]})}}return t})()}}]);