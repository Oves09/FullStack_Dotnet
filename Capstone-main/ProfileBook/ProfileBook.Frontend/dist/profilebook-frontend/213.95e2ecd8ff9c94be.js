"use strict";(self.webpackChunkprofilebook_frontend=self.webpackChunkprofilebook_frontend||[]).push([[213],{3213:(x,g,p)=>{p.r(g),p.d(g,{ReportManagementComponent:()=>E});var m=p(177),d=p(4341),o=p(3252),e=p(4438),_=p(7945);function u(i,c){1&i&&(e.j41(0,"div",21)(1,"div",22)(2,"span",23),e.EFF(3,"Loading reports..."),e.k0s()(),e.j41(4,"p",24),e.EFF(5,"Loading reports..."),e.k0s()())}function f(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",21),e.nrm(1,"i",25),e.j41(2,"h5",26),e.EFF(3,"No reports found"),e.k0s(),e.j41(4,"p",26),e.EFF(5),e.k0s(),e.j41(6,"button",27),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.loadReports())}),e.nrm(7,"i",28),e.EFF(8,"Refresh "),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(5),e.SpI(" ",null!==t.selectedStatus?"No reports with this status.":"No reports have been submitted yet."," ")}}function R(i,c){if(1&i&&(e.j41(0,"div",44)(1,"strong"),e.EFF(2,"Description:"),e.k0s(),e.j41(3,"p",50),e.EFF(4),e.k0s()()),2&i){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.description)}}function v(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" by ",t.reviewedByUserName,"")}}function h(i,c){if(1&i&&(e.j41(0,"div",51)(1,"div",52)(2,"h6",53),e.nrm(3,"i",54),e.EFF(4,"Previous Admin Response "),e.k0s(),e.j41(5,"p",36),e.EFF(6),e.k0s(),e.j41(7,"small",26),e.EFF(8),e.DNE(9,v,2,1,"span",18),e.k0s()()()),2&i){const t=e.XpG().$implicit,s=e.XpG(2);e.R7$(),e.Y8G("ngClass",s.getAdminResponseClass(t.status)),e.R7$(5),e.JRh(t.adminNotes),e.R7$(2),e.SpI(" Reviewed ",s.formatDate(t.reviewedAt)," "),e.R7$(),e.Y8G("ngIf",t.reviewedByUserName)}}function b(i,c){1&i&&e.nrm(0,"span",68)}function F(i,c){1&i&&e.nrm(0,"i",69)}function k(i,c){1&i&&e.nrm(0,"span",68)}function M(i,c){1&i&&e.nrm(0,"i",70)}function P(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",55)(1,"form",56),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG(),r=n.$implicit,a=n.index,l=e.XpG(2);return e.Njj(l.reviewReport(r,a,l.ReportStatus.Resolved))}),e.j41(2,"div",51)(3,"label",57),e.EFF(4,"Admin Notes "),e.j41(5,"span",58),e.EFF(6,"*"),e.k0s()(),e.nrm(7,"textarea",59),e.j41(8,"div",60),e.EFF(9," Admin notes are required when reviewing a report. "),e.k0s()(),e.j41(10,"div",61)(11,"button",62),e.DNE(12,b,1,0,"span",63)(13,F,1,0,"i",64),e.EFF(14),e.k0s(),e.j41(15,"button",65),e.bIt("click",function(){e.eBV(t);const n=e.XpG(),r=n.$implicit,a=n.index,l=e.XpG(2);return e.Njj(l.reviewReport(r,a,l.ReportStatus.Dismissed))}),e.DNE(16,k,1,0,"span",63)(17,M,1,0,"i",66),e.EFF(18),e.k0s(),e.j41(19,"button",67),e.bIt("click",function(){e.eBV(t);const n=e.XpG(),r=n.$implicit,a=n.index,l=e.XpG(2);return e.Njj(l.markUnderReview(r,a))}),e.nrm(20,"i",12),e.EFF(21," Mark Under Review "),e.k0s()()()()}if(2&i){let t;const s=e.XpG(),n=s.$implicit,r=s.index,a=e.XpG(2);e.R7$(),e.Y8G("formGroup",a.getReviewForm(r)),e.R7$(6),e.AVh("is-invalid",(null==(t=a.getReviewForm(r).get("adminNotes"))?null:t.invalid)&&(null==(t=a.getReviewForm(r).get("adminNotes"))?null:t.touched)),e.R7$(4),e.Y8G("disabled",a.isProcessing[r]||a.getReviewForm(r).invalid),e.R7$(),e.Y8G("ngIf",a.isProcessing[r]),e.R7$(),e.Y8G("ngIf",!a.isProcessing[r]),e.R7$(),e.SpI(" ",a.isProcessing[r]?"Resolving...":"Mark as Resolved"," "),e.R7$(),e.Y8G("disabled",a.isProcessing[r]||a.getReviewForm(r).invalid),e.R7$(),e.Y8G("ngIf",a.isProcessing[r]),e.R7$(),e.Y8G("ngIf",!a.isProcessing[r]),e.R7$(),e.SpI(" ",a.isProcessing[r]?"Dismissing...":"Dismiss Report"," "),e.R7$(),e.Y8G("disabled",a.isProcessing[r]||n.status===a.ReportStatus.UnderReview)}}function S(i,c){if(1&i&&(e.j41(0,"div",31)(1,"div",7)(2,"div",32)(3,"div",33)(4,"div",34)(5,"div",35)(6,"h6",36),e.EFF(7," Report against "),e.j41(8,"strong"),e.EFF(9),e.k0s(),e.j41(10,"small",26),e.EFF(11),e.k0s()(),e.j41(12,"p",37),e.EFF(13," Reported by "),e.j41(14,"strong"),e.EFF(15),e.k0s(),e.j41(16,"small"),e.EFF(17),e.k0s()(),e.j41(18,"small",26),e.EFF(19),e.k0s()()()(),e.j41(20,"div",38)(21,"span",39),e.nrm(22,"i",40),e.EFF(23),e.k0s()()(),e.j41(24,"div",41)(25,"div",42)(26,"div",43)(27,"div",44)(28,"strong"),e.EFF(29,"Reason:"),e.k0s(),e.j41(30,"span",45),e.EFF(31),e.k0s()()(),e.j41(32,"div",43)(33,"div",44)(34,"strong"),e.EFF(35,"Report ID:"),e.k0s(),e.j41(36,"span",46),e.EFF(37),e.k0s()()()(),e.DNE(38,R,5,1,"div",47)(39,h,10,4,"div",48),e.k0s(),e.DNE(40,P,22,12,"div",49),e.k0s()()),2&i){const t=c.$implicit,s=e.XpG(2);e.R7$(9),e.JRh(t.reportedUserFullName),e.R7$(2),e.SpI("(","@"+t.reportedUserName,")"),e.R7$(4),e.JRh(t.reportingUserFullName),e.R7$(2),e.SpI("(","@"+t.reportingUserName,")"),e.R7$(2),e.JRh(s.formatDate(t.timeStamp)),e.R7$(2),e.Y8G("ngClass",s.getStatusBadgeClass(t.status)),e.R7$(),e.HbH(s.getStatusIcon(t.status)),e.R7$(),e.SpI(" ",s.getStatusText(t.status)," "),e.R7$(8),e.JRh(t.reason),e.R7$(6),e.SpI("#",t.reportId,""),e.R7$(),e.Y8G("ngIf",t.description),e.R7$(),e.Y8G("ngIf",t.adminNotes&&t.status!==s.ReportStatus.Pending),e.R7$(),e.Y8G("ngIf",t.status===s.ReportStatus.Pending||t.status===s.ReportStatus.UnderReview)}}function C(i,c){if(1&i&&(e.j41(0,"div",29),e.DNE(1,S,41,14,"div",30),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.paginatedReports)}}function I(i,c){if(1&i){const t=e.RV6();e.j41(0,"li",72)(1,"button",73),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.changePage(n))}),e.EFF(2),e.k0s()()}if(2&i){const t=c.$implicit,s=e.XpG(2);e.AVh("active",t===s.currentPage),e.R7$(2),e.JRh(t)}}function w(i,c){if(1&i){const t=e.RV6();e.j41(0,"nav")(1,"ul",71)(2,"li",72)(3,"button",73),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.changePage(n.currentPage-1))}),e.EFF(4,"Previous"),e.k0s()(),e.DNE(5,I,3,3,"li",74),e.j41(6,"li",72)(7,"button",73),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.changePage(n.currentPage+1))}),e.EFF(8,"Next"),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(2),e.AVh("disabled",1===t.currentPage),e.R7$(3),e.Y8G("ngForOf",t.getPageNumbers()),e.R7$(),e.AVh("disabled",t.currentPage===t.totalPages)}}function $(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",75),e.nrm(1,"i",76),e.EFF(2),e.j41(3,"button",77),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.successMessage="")}),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(2),e.SpI("",t.successMessage," ")}}function j(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",78),e.nrm(1,"i",79),e.EFF(2),e.j41(3,"button",77),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.errorMessage="")}),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(2),e.SpI("",t.errorMessage," ")}}let E=(()=>{class i{constructor(t,s){this.fb=t,this.adminService=s,this.allReports=[],this.filteredReports=[],this.paginatedReports=[],this.reviewForms=[],this.isLoading=!1,this.isProcessing=[],this.successMessage="",this.errorMessage="",this.selectedStatus=o.n.Pending,this.currentPage=1,this.pageSize=5,this.totalPages=1,this.ReportStatus=o.n}ngOnInit(){this.loadReports()}loadReports(){this.isLoading=!0,this.errorMessage="",this.adminService.getAllReports().subscribe({next:t=>{this.allReports=t,this.filterByStatus(this.selectedStatus),this.isLoading=!1},error:t=>{this.isLoading=!1,this.errorMessage="Failed to load reports. Please try again.",console.error("Error loading reports:",t)}})}filterByStatus(t){this.selectedStatus=t,this.filteredReports=null===t?[...this.allReports]:this.allReports.filter(s=>s.status===t),this.currentPage=1,this.initializeForms(),this.updatePagination()}initializeForms(){this.reviewForms=[],this.isProcessing=[],this.filteredReports.forEach(()=>{this.reviewForms.push(this.fb.group({adminNotes:["",d.k0.required]})),this.isProcessing.push(!1)})}getReviewForm(t){return this.reviewForms[t]}updatePagination(){this.totalPages=Math.ceil(this.filteredReports.length/this.pageSize);const t=(this.currentPage-1)*this.pageSize;this.paginatedReports=this.filteredReports.slice(t,t+this.pageSize)}changePage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.updatePagination())}getPageNumbers(){const t=[];let n=Math.max(1,this.currentPage-Math.floor(2.5)),r=Math.min(this.totalPages,n+5-1);r-n<4&&(n=Math.max(1,r-5+1));for(let a=n;a<=r;a++)t.push(a);return t}reviewReport(t,s,n){const r=this.getReviewForm(s);if(r.invalid)return void r.markAllAsTouched();this.isProcessing[s]=!0,this.errorMessage="",this.successMessage="";const a={reportId:t.reportId,status:n,adminNotes:r.get("adminNotes")?.value};this.adminService.reviewReport(a).subscribe({next:()=>{this.isProcessing[s]=!1,this.successMessage=`Report ${n===o.n.Resolved?"resolved":"dismissed"} successfully!`;const l=this.allReports.findIndex(G=>G.reportId===t.reportId);l>-1&&(this.allReports[l].status=n,this.allReports[l].adminNotes=a.adminNotes,this.allReports[l].reviewedAt=new Date),this.filterByStatus(this.selectedStatus)},error:l=>{this.isProcessing[s]=!1,this.errorMessage=l.error?.message||"Failed to review report. Please try again.",console.error("Error reviewing report:",l)}})}markUnderReview(t,s){this.reviewReport(t,s,o.n.UnderReview)}getStatusCount(t){return this.allReports.filter(s=>s.status===t).length}getStatusBadgeClass(t){switch(t){case o.n.Pending:return"bg-warning";case o.n.UnderReview:return"bg-info";case o.n.Resolved:return"bg-success";default:return"bg-secondary"}}getStatusIcon(t){switch(t){case o.n.Pending:return"fas fa-clock";case o.n.UnderReview:return"fas fa-search";case o.n.Resolved:return"fas fa-check-circle";case o.n.Dismissed:return"fas fa-times-circle";default:return"fas fa-question-circle"}}getStatusText(t){switch(t){case o.n.Pending:return"Pending";case o.n.UnderReview:return"Under Review";case o.n.Resolved:return"Resolved";case o.n.Dismissed:return"Dismissed";default:return"Unknown"}}getAdminResponseClass(t){switch(t){case o.n.Resolved:return"alert-success";case o.n.Dismissed:return"alert-secondary";default:return"alert-info"}}formatDate(t){const s=new Date(t),r=Math.floor(((new Date).getTime()-s.getTime())/6e4);return r<60?`${r}m ago`:r<1440?`${Math.floor(r/60)}h ago`:r<10080?`${Math.floor(r/1440)}d ago`:s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}static{this.\u0275fac=function(s){return new(s||i)(e.rXU(d.ok),e.rXU(_.z))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-report-management"]],standalone:!0,features:[e.aNF],decls:36,vars:21,consts:[[1,"container","mt-4"],[1,"row","justify-content-center"],[1,"col-lg-12"],[1,"card","shadow-sm"],[1,"card-header","bg-warning","text-dark"],[1,"mb-0"],[1,"fas","fa-flag","me-2"],[1,"card-body"],[1,"nav","nav-tabs","mb-4"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"fas","fa-clock","me-1"],[1,"fas","fa-search","me-1"],[1,"fas","fa-check-circle","me-1"],[1,"fas","fa-times-circle","me-1"],[1,"fas","fa-list","me-1"],["class","text-center py-5",4,"ngIf"],["class","reports-list",4,"ngIf"],[4,"ngIf"],["class","alert alert-success alert-dismissible fade show",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-warning"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"fas","fa-shield-alt","fa-4x","text-muted","mb-3"],[1,"text-muted"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-sync-alt","me-2"],[1,"reports-list"],["class","report-card card mb-4",4,"ngFor","ngForOf"],[1,"report-card","card","mb-4"],[1,"row","mb-3"],[1,"col-md-8"],[1,"d-flex","align-items-start"],[1,"flex-grow-1"],[1,"mb-1"],[1,"mb-1","text-muted"],[1,"col-md-4","text-end"],[1,"badge",3,"ngClass"],[1,"me-1"],[1,"report-details","mb-3"],[1,"row"],[1,"col-md-6"],[1,"mb-2"],[1,"ms-2","badge","bg-secondary"],[1,"ms-2","font-monospace"],["class","mb-2",4,"ngIf"],["class","mb-3",4,"ngIf"],["class","action-section border-top pt-3",4,"ngIf"],[1,"mb-0","mt-1","p-2","bg-light","rounded"],[1,"mb-3"],[1,"alert",3,"ngClass"],[1,"alert-heading"],[1,"fas","fa-user-shield","me-2"],[1,"action-section","border-top","pt-3"],[3,"ngSubmit","formGroup"],[1,"form-label"],[1,"text-danger"],["formControlName","adminNotes","rows","3","placeholder","Provide details about your decision and any actions taken...",1,"form-control"],[1,"invalid-feedback"],[1,"d-flex","gap-2"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-check me-1",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["class","fas fa-times me-1",4,"ngIf"],["type","button",1,"btn","btn-info",3,"click","disabled"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-check","me-1"],[1,"fas","fa-times","me-1"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"alert","alert-success","alert-dismissible","fade","show"],[1,"fas","fa-check-circle","me-2"],["type","button",1,"btn-close",3,"click"],[1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"fas","fa-exclamation-triangle","me-2"]],template:function(s,n){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),e.nrm(6,"i",6),e.EFF(7,"Report Management "),e.k0s()(),e.j41(8,"div",7)(9,"ul",8)(10,"li",9)(11,"button",10),e.bIt("click",function(){return n.filterByStatus(n.ReportStatus.Pending)}),e.nrm(12,"i",11),e.EFF(13),e.k0s()(),e.j41(14,"li",9)(15,"button",10),e.bIt("click",function(){return n.filterByStatus(n.ReportStatus.UnderReview)}),e.nrm(16,"i",12),e.EFF(17),e.k0s()(),e.j41(18,"li",9)(19,"button",10),e.bIt("click",function(){return n.filterByStatus(n.ReportStatus.Resolved)}),e.nrm(20,"i",13),e.EFF(21),e.k0s()(),e.j41(22,"li",9)(23,"button",10),e.bIt("click",function(){return n.filterByStatus(n.ReportStatus.Dismissed)}),e.nrm(24,"i",14),e.EFF(25),e.k0s()(),e.j41(26,"li",9)(27,"button",10),e.bIt("click",function(){return n.filterByStatus(null)}),e.nrm(28,"i",15),e.EFF(29),e.k0s()()(),e.DNE(30,u,6,0,"div",16)(31,f,9,1,"div",16)(32,C,2,1,"div",17)(33,w,9,5,"nav",18)(34,$,4,1,"div",19)(35,j,4,1,"div",20),e.k0s()()()()()),2&s&&(e.R7$(11),e.AVh("active",n.selectedStatus===n.ReportStatus.Pending),e.R7$(2),e.SpI(" Pending (",n.getStatusCount(n.ReportStatus.Pending),") "),e.R7$(2),e.AVh("active",n.selectedStatus===n.ReportStatus.UnderReview),e.R7$(2),e.SpI(" Under Review (",n.getStatusCount(n.ReportStatus.UnderReview),") "),e.R7$(2),e.AVh("active",n.selectedStatus===n.ReportStatus.Resolved),e.R7$(2),e.SpI(" Resolved (",n.getStatusCount(n.ReportStatus.Resolved),") "),e.R7$(2),e.AVh("active",n.selectedStatus===n.ReportStatus.Dismissed),e.R7$(2),e.SpI(" Dismissed (",n.getStatusCount(n.ReportStatus.Dismissed),") "),e.R7$(2),e.AVh("active",null===n.selectedStatus),e.R7$(2),e.SpI(" All Reports (",n.allReports.length,") "),e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading&&0===n.filteredReports.length),e.R7$(),e.Y8G("ngIf",!n.isLoading&&n.filteredReports.length>0),e.R7$(),e.Y8G("ngIf",!n.isLoading&&n.filteredReports.length>n.pageSize),e.R7$(),e.Y8G("ngIf",n.successMessage),e.R7$(),e.Y8G("ngIf",n.errorMessage))},dependencies:[m.MD,m.YU,m.Sq,m.bT,d.X1,d.qT,d.me,d.BC,d.cb,d.j4,d.JD],styles:[".report-card[_ngcontent-%COMP%]{border:none;box-shadow:0 2px 4px #0000001a;transition:transform .2s ease,box-shadow .2s ease}.report-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #00000026}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{border:none;color:var(--text-muted);background:transparent}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background-color:var(--warning);color:var(--dark);border-color:var(--warning)}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{border-color:transparent;background-color:var(--light)}.action-section[_ngcontent-%COMP%]{background-color:var(--light-bg);margin:-1rem -1rem 0;padding:1rem;border-radius:0 0 .75rem .75rem}.badge[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem .75rem}.font-monospace[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:.875rem}.alert-heading[_ngcontent-%COMP%]{font-size:.9rem;margin-bottom:.5rem}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:0 1rem}.nav-tabs[_ngcontent-%COMP%]{flex-wrap:wrap}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem .75rem}.d-flex.gap-2[_ngcontent-%COMP%]{flex-direction:column}.d-flex.gap-2[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:.5rem}}"]})}}return i})()}}]);