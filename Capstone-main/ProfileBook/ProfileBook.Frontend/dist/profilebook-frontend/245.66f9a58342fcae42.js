"use strict";(self.webpackChunkprofilebook_frontend=self.webpackChunkprofilebook_frontend||[]).push([[245],{1245:(I,m,a)=>{a.r(m),a.d(m,{ProfileComponent:()=>P});var l=a(177),n=a(4341),e=a(4438),f=a(9885),d=a(4796);function u(i,o){1&i&&(e.j41(0,"div",11)(1,"div",12)(2,"span",13),e.EFF(3,"Loading profile..."),e.k0s()(),e.j41(4,"p",14),e.EFF(5,"Loading your profile..."),e.k0s()())}function p(i,o){1&i&&(e.j41(0,"div",50),e.EFF(1," First name is required "),e.k0s())}function g(i,o){1&i&&(e.j41(0,"div",50),e.EFF(1," Last name is required "),e.k0s())}function _(i,o){if(1&i&&(e.j41(0,"span",51),e.EFF(1),e.k0s()),2&i){const t=o.$implicit;e.R7$(),e.SpI(" ",t," ")}}function h(i,o){if(1&i){const t=e.RV6();e.j41(0,"div",52),e.nrm(1,"i",53),e.EFF(2),e.j41(3,"button",54),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.successMessage="")}),e.k0s()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.SpI("",t.successMessage," ")}}function b(i,o){if(1&i){const t=e.RV6();e.j41(0,"div",55),e.nrm(1,"i",56),e.EFF(2),e.j41(3,"button",54),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.errorMessage="")}),e.k0s()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.SpI("",t.errorMessage," ")}}function v(i,o){1&i&&e.nrm(0,"span",57)}function F(i,o){1&i&&e.nrm(0,"i",58)}function k(i,o){if(1&i){const t=e.RV6();e.j41(0,"form",15),e.bIt("ngSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.onUpdateProfile())}),e.j41(1,"div",16)(2,"div",17),e.nrm(3,"img",18),e.j41(4,"button",19),e.bIt("click",function(){e.eBV(t);const s=e.sdS(7);return e.Njj(s.click())}),e.nrm(5,"i",20),e.k0s()(),e.j41(6,"input",21,0),e.bIt("change",function(s){e.eBV(t);const c=e.XpG();return e.Njj(c.onImageSelected(s))}),e.k0s(),e.j41(8,"p",22),e.EFF(9,"Click the camera icon to change your profile picture"),e.k0s()(),e.j41(10,"div",23)(11,"div",24)(12,"label",25),e.EFF(13,"First Name"),e.k0s(),e.nrm(14,"input",26),e.DNE(15,p,2,0,"div",27),e.k0s(),e.j41(16,"div",24)(17,"label",28),e.EFF(18,"Last Name"),e.k0s(),e.nrm(19,"input",29),e.DNE(20,g,2,0,"div",27),e.k0s()(),e.j41(21,"div",23)(22,"div",24)(23,"label",30),e.EFF(24,"Username"),e.k0s(),e.nrm(25,"input",31),e.k0s(),e.j41(26,"div",24)(27,"label",32),e.EFF(28,"Email"),e.k0s(),e.nrm(29,"input",33),e.k0s()(),e.j41(30,"div",34)(31,"label",35),e.EFF(32,"Bio"),e.k0s(),e.nrm(33,"textarea",36),e.k0s(),e.j41(34,"div",23)(35,"div",24)(36,"label",37),e.EFF(37,"Member Since"),e.k0s(),e.nrm(38,"input",38),e.k0s(),e.j41(39,"div",24)(40,"label",37),e.EFF(41,"Account Status"),e.k0s(),e.nrm(42,"input",38),e.k0s()(),e.j41(43,"div",39)(44,"label",37),e.EFF(45,"Roles"),e.k0s(),e.j41(46,"div",40),e.DNE(47,_,2,1,"span",41),e.k0s()(),e.DNE(48,h,4,1,"div",42)(49,b,4,1,"div",43),e.j41(50,"div",44)(51,"button",45),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.resetForm())}),e.nrm(52,"i",46),e.EFF(53,"Reset "),e.k0s(),e.j41(54,"button",47),e.DNE(55,v,1,0,"span",48)(56,F,1,0,"i",49),e.EFF(57),e.k0s()()()}if(2&i){const t=e.XpG();e.Y8G("formGroup",t.profileForm),e.R7$(3),e.Y8G("src",t.getProfileImage(),e.B4B),e.R7$(11),e.AVh("is-invalid",t.isFieldInvalid("firstName")),e.R7$(),e.Y8G("ngIf",t.isFieldInvalid("firstName")),e.R7$(4),e.AVh("is-invalid",t.isFieldInvalid("lastName")),e.R7$(),e.Y8G("ngIf",t.isFieldInvalid("lastName")),e.R7$(5),e.Y8G("value",null==t.currentUser?null:t.currentUser.userName),e.R7$(4),e.Y8G("value",null==t.currentUser?null:t.currentUser.email),e.R7$(9),e.Y8G("value",t.formatDate(null==t.currentUser?null:t.currentUser.createdAt)),e.R7$(4),e.Y8G("value",null!=t.currentUser&&t.currentUser.isActive?"Active":"Inactive"),e.R7$(5),e.Y8G("ngForOf",null==t.currentUser?null:t.currentUser.roles),e.R7$(),e.Y8G("ngIf",t.successMessage),e.R7$(),e.Y8G("ngIf",t.errorMessage),e.R7$(5),e.Y8G("disabled",t.profileForm.invalid||t.isUpdating),e.R7$(),e.Y8G("ngIf",t.isUpdating),e.R7$(),e.Y8G("ngIf",!t.isUpdating),e.R7$(),e.SpI(" ",t.isUpdating?"Updating...":"Update Profile"," ")}}let P=(()=>{class i{constructor(t,r,s){this.fb=t,this.userService=r,this.authService=s,this.currentUser=null,this.isLoading=!1,this.isUpdating=!1,this.selectedFile=null,this.successMessage="",this.errorMessage="",this.profileForm=this.fb.group({firstName:["",[n.k0.required]],lastName:["",[n.k0.required]],bio:[""]})}ngOnInit(){this.loadProfile()}loadProfile(){this.isLoading=!0,this.userService.getProfile().subscribe({next:t=>{this.currentUser=t,this.profileForm.patchValue({firstName:t.firstName||"",lastName:t.lastName||"",bio:t.bio||""}),this.isLoading=!1},error:t=>{this.isLoading=!1,this.errorMessage="Failed to load profile. Please try again.",console.error("Error loading profile:",t)}})}onUpdateProfile(){if(this.profileForm.valid){this.isUpdating=!0,this.errorMessage="",this.successMessage="";const t={firstName:this.profileForm.get("firstName")?.value,lastName:this.profileForm.get("lastName")?.value,bio:this.profileForm.get("bio")?.value,profileImage:this.selectedFile||void 0};this.userService.updateProfile(t).subscribe({next:r=>{this.isUpdating=!1,this.currentUser=r,this.selectedFile=null,this.successMessage="Profile updated successfully!",this.authService.currentUser$.subscribe(s=>{if(s){const c={...s,...r};localStorage.setItem("user",JSON.stringify(c))}})},error:r=>{this.isUpdating=!1,this.errorMessage=r.error?.message||"Failed to update profile. Please try again.",console.error("Error updating profile:",r)}})}else this.markFormGroupTouched()}onImageSelected(t){const r=t.target.files[0];if(r){if(r.size>5242880)return void(this.errorMessage="Image size must be less than 5MB");if(!r.type.startsWith("image/"))return void(this.errorMessage="Please select a valid image file");this.selectedFile=r,this.errorMessage=""}}getProfileImage(){return this.currentUser?.profileImagePath?this.getFullImageUrl(this.currentUser.profileImagePath):"https://via.placeholder.com/120x120/3b82f6/ffffff?text="+(this.currentUser?.firstName?.charAt(0)||this.currentUser?.userName?.charAt(0)||"U")}getFullImageUrl(t){return t?t.startsWith("http")?t:`http://localhost:5120${t}`:""}formatDate(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}resetForm(){this.currentUser&&(this.profileForm.patchValue({firstName:this.currentUser?.firstName||"",lastName:this.currentUser?.lastName||"",bio:this.currentUser.bio||""}),this.selectedFile=null,this.errorMessage="",this.successMessage="")}isFieldInvalid(t){const r=this.profileForm.get(t);return!(!r||!r.invalid||!r.dirty&&!r.touched)}markFormGroupTouched(){Object.keys(this.profileForm.controls).forEach(t=>{this.profileForm.get(t)?.markAsTouched()})}static{this.\u0275fac=function(r){return new(r||i)(e.rXU(n.ok),e.rXU(f.D),e.rXU(d.u))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-profile"]],standalone:!0,features:[e.aNF],decls:11,vars:2,consts:[["fileInput",""],[1,"container","mt-4"],[1,"row","justify-content-center"],[1,"col-lg-8"],[1,"card","shadow-sm"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"fas","fa-user","me-2"],[1,"card-body"],["class","text-center py-5",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[3,"ngSubmit","formGroup"],[1,"text-center","mb-4"],[1,"position-relative","d-inline-block"],["width","120","height","120","alt","Profile Picture",1,"rounded-circle","profile-image",3,"src"],["type","button",1,"btn","btn-primary","btn-sm","position-absolute","bottom-0","end-0","rounded-circle",2,"width","36px","height","36px",3,"click"],[1,"fas","fa-camera"],["type","file","accept","image/*",1,"d-none",3,"change"],[1,"text-muted","mt-2","mb-0"],[1,"row"],[1,"col-md-6","mb-3"],["for","firstName",1,"form-label"],["type","text","id","firstName","formControlName","firstName",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","lastName",1,"form-label"],["type","text","id","lastName","formControlName","lastName",1,"form-control"],["for","userName",1,"form-label"],["type","text","id","userName","readonly","",1,"form-control",3,"value"],["for","email",1,"form-label"],["type","email","id","email","readonly","",1,"form-control",3,"value"],[1,"mb-3"],["for","bio",1,"form-label"],["id","bio","formControlName","bio","rows","4","placeholder","Tell us about yourself...",1,"form-control"],[1,"form-label"],["type","text","readonly","",1,"form-control",3,"value"],[1,"mb-4"],[1,"d-flex","flex-wrap","gap-2"],["class","badge bg-primary rounded-pill",4,"ngFor","ngForOf"],["class","alert alert-success alert-dismissible fade show",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show",4,"ngIf"],[1,"d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-undo","me-1"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-save me-1",4,"ngIf"],[1,"invalid-feedback"],[1,"badge","bg-primary","rounded-pill"],[1,"alert","alert-success","alert-dismissible","fade","show"],[1,"fas","fa-check-circle","me-2"],["type","button",1,"btn-close",3,"click"],[1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-save","me-1"]],template:function(r,s){1&r&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h4",6),e.nrm(6,"i",7),e.EFF(7,"My Profile "),e.k0s()(),e.j41(8,"div",8),e.DNE(9,u,6,0,"div",9)(10,k,58,19,"form",10),e.k0s()()()()()),2&r&&(e.R7$(9),e.Y8G("ngIf",s.isLoading),e.R7$(),e.Y8G("ngIf",!s.isLoading))},dependencies:[l.MD,l.Sq,l.bT,n.X1,n.qT,n.me,n.BC,n.cb,n.j4,n.JD],styles:[".profile-image[_ngcontent-%COMP%]{object-fit:cover;border:4px solid var(--border-color);transition:transform .2s ease}.profile-image[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.form-control[readonly][_ngcontent-%COMP%]{background-color:var(--light-bg);border-color:var(--border-color)}.badge[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem .75rem}.card-header[_ngcontent-%COMP%]{border-radius:.75rem .75rem 0 0!important}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:0 1rem}.profile-image[_ngcontent-%COMP%]{width:100px!important;height:100px!important}.d-flex.justify-content-end[_ngcontent-%COMP%]{flex-direction:column}.d-flex.justify-content-end[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:.5rem}}"]})}}return i})()}}]);