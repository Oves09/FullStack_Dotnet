"use strict";(self.webpackChunkprofilebook_frontend=self.webpackChunkprofilebook_frontend||[]).push([[5],{8005:(w,m,c)=>{c.r(m),c.d(m,{GroupManagementComponent:()=>$});var d=c(177),i=c(4341),e=c(4438),u=c(7945);function p(r,n){1&r&&(e.j41(0,"div",42),e.EFF(1," Group name is required "),e.k0s())}function g(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",29)(1,"div",44)(2,"input",45),e.bIt("change",function(o){const a=e.eBV(t).$implicit,l=e.XpG(3);return e.Njj(l.onMemberSelectionChange(o,a.id))}),e.k0s(),e.j41(3,"label",46),e.EFF(4),e.k0s()()()}if(2&r){const t=n.$implicit,s=e.XpG(3);e.R7$(2),e.Y8G("id","user-"+t.id)("value",t.id)("checked",s.selectedMemberIds.includes(t.id)),e.R7$(),e.Y8G("for","user-"+t.id),e.R7$(),e.Lme(" ",t.fullName||t.userName," (",t.email,") ")}}function f(r,n){if(1&r&&(e.j41(0,"div",28),e.DNE(1,g,5,6,"div",43),e.k0s()),2&r){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.availableUsers)("ngForTrackBy",t.trackByUserId)}}function _(r,n){1&r&&(e.j41(0,"div",47)(1,"div",48),e.nrm(2,"div",49),e.EFF(3," Loading users... "),e.k0s()())}function h(r,n){if(1&r&&(e.j41(0,"div",50)(1,"small",47),e.EFF(2),e.k0s()()),2&r){const t=e.XpG(2);e.R7$(2),e.SpI("",t.selectedMemberIds.length," member(s) selected")}}function b(r,n){1&r&&e.nrm(0,"span",51)}function v(r,n){1&r&&e.nrm(0,"i",52)}function G(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",25)(1,"div",26)(2,"h5",5),e.EFF(3),e.k0s()(),e.j41(4,"div",9)(5,"form",27),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.createGroup())}),e.j41(6,"div",28)(7,"div",29)(8,"div",30)(9,"label",31),e.EFF(10,"Group Name *"),e.k0s(),e.nrm(11,"input",32),e.DNE(12,p,2,0,"div",33),e.k0s()(),e.j41(13,"div",29)(14,"div",30)(15,"label",31),e.EFF(16,"Description"),e.k0s(),e.nrm(17,"textarea",34),e.k0s()()(),e.j41(18,"div",30)(19,"label",31),e.EFF(20,"Select Members"),e.k0s(),e.DNE(21,f,2,2,"div",21)(22,_,4,0,"div",35)(23,h,3,1,"div",36),e.k0s(),e.j41(24,"div",37)(25,"button",38),e.DNE(26,b,1,0,"span",39)(27,v,1,0,"i",40),e.EFF(28),e.k0s(),e.j41(29,"button",41),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.cancelCreate())}),e.EFF(30," Cancel "),e.k0s()()()()()}if(2&r){let t;const s=e.XpG();e.R7$(3),e.JRh(null!=s.selectedGroup&&s.selectedGroup.groupId?"Edit Group":"Create New Group"),e.R7$(2),e.Y8G("formGroup",s.createGroupForm),e.R7$(7),e.Y8G("ngIf",(null==(t=s.createGroupForm.get("groupName"))?null:t.invalid)&&(null==(t=s.createGroupForm.get("groupName"))?null:t.touched)),e.R7$(9),e.Y8G("ngIf",s.availableUsers.length>0),e.R7$(),e.Y8G("ngIf",0===s.availableUsers.length),e.R7$(),e.Y8G("ngIf",s.selectedMemberIds.length>0),e.R7$(2),e.Y8G("disabled",s.createGroupForm.invalid||s.isCreating),e.R7$(),e.Y8G("ngIf",s.isCreating),e.R7$(),e.Y8G("ngIf",!s.isCreating),e.R7$(),e.SpI(" ",s.isCreating?null!=s.selectedGroup&&s.selectedGroup.groupId?"Updating...":"Creating...":null!=s.selectedGroup&&s.selectedGroup.groupId?"Update Group":"Create Group"," ")}}function M(r,n){1&r&&(e.j41(0,"div",53)(1,"div",54)(2,"span",55),e.EFF(3,"Loading groups..."),e.k0s()(),e.j41(4,"p",56),e.EFF(5,"Loading groups..."),e.k0s()())}function F(r,n){1&r&&e.nrm(0,"span",73)}function k(r,n){1&r&&e.nrm(0,"i",74)}function C(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",58)(1,"div",59)(2,"div",60)(3,"h6",5),e.EFF(4),e.k0s(),e.j41(5,"div",61)(6,"button",62),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.viewGroup(o))}),e.nrm(7,"i",63),e.k0s(),e.j41(8,"button",64),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.editGroup(o))}),e.nrm(9,"i",65),e.k0s(),e.j41(10,"button",66),e.bIt("click",function(){const o=e.eBV(t),a=o.$implicit,l=o.index,T=e.XpG(2);return e.Njj(T.deleteGroup(a,l))}),e.DNE(11,F,1,0,"span",67)(12,k,1,0,"i",68),e.k0s()()(),e.j41(13,"div",9)(14,"p",69),e.EFF(15),e.k0s(),e.j41(16,"div",70)(17,"small",47),e.nrm(18,"i",71),e.EFF(19),e.k0s(),e.j41(20,"small",47),e.EFF(21),e.k0s()(),e.j41(22,"div",50)(23,"small",47),e.nrm(24,"i",72),e.EFF(25),e.k0s()()()()()}if(2&r){const t=n.$implicit,s=n.index,o=e.XpG(2);e.R7$(4),e.JRh(t.groupName),e.R7$(6),e.Y8G("disabled",o.isProcessing[s]),e.R7$(),e.Y8G("ngIf",o.isProcessing[s]),e.R7$(),e.Y8G("ngIf",!o.isProcessing[s]),e.R7$(3),e.JRh(t.description||"No description"),e.R7$(4),e.SpI("",t.memberCount," members "),e.R7$(2),e.SpI(" Created: ",o.formatDate(t.createdAt)," "),e.R7$(4),e.SpI("Created by: ",t.createdByUserName," ")}}function I(r,n){if(1&r&&(e.j41(0,"div",28),e.DNE(1,C,26,8,"div",57),e.k0s()),2&r){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.filteredGroups)}}function j(r,n){1&r&&(e.j41(0,"div",53),e.nrm(1,"i",75),e.j41(2,"h5",47),e.EFF(3,"No groups found"),e.k0s(),e.j41(4,"p",47),e.EFF(5,"No groups match your current search criteria."),e.k0s()())}function E(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",76),e.nrm(1,"i",77),e.EFF(2),e.j41(3,"button",78),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.successMessage="")}),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(2),e.SpI("",t.successMessage," ")}}function R(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",79),e.nrm(1,"i",80),e.EFF(2),e.j41(3,"button",78),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.errorMessage="")}),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(2),e.SpI("",t.errorMessage," ")}}function y(r,n){if(1&r&&(e.j41(0,"div",96)(1,"div",48)(2,"div")(3,"div",97),e.EFF(4),e.k0s(),e.j41(5,"small",47),e.EFF(6),e.k0s()()()()),2&r){const t=n.$implicit;e.R7$(4),e.Lme("",t.firstName," ",t.lastName,""),e.R7$(2),e.JRh(t.email)}}function N(r,n){1&r&&(e.j41(0,"div",98),e.EFF(1," No members in this group "),e.k0s())}function x(r,n){if(1&r&&(e.j41(0,"div",81)(1,"div",82)(2,"div",83)(3,"div",84)(4,"h5",85),e.nrm(5,"i",86),e.EFF(6),e.k0s(),e.nrm(7,"button",87),e.k0s(),e.j41(8,"div",88)(9,"div",28)(10,"div",29)(11,"h6"),e.EFF(12,"Group Information"),e.k0s(),e.j41(13,"table",89)(14,"tr")(15,"th",90),e.EFF(16,"Name:"),e.k0s(),e.j41(17,"td"),e.EFF(18),e.k0s()(),e.j41(19,"tr")(20,"th"),e.EFF(21,"Description:"),e.k0s(),e.j41(22,"td"),e.EFF(23),e.k0s()(),e.j41(24,"tr")(25,"th"),e.EFF(26,"Created by:"),e.k0s(),e.j41(27,"td"),e.EFF(28),e.k0s()(),e.j41(29,"tr")(30,"th"),e.EFF(31,"Created:"),e.k0s(),e.j41(32,"td"),e.EFF(33),e.k0s()(),e.j41(34,"tr")(35,"th"),e.EFF(36,"Members:"),e.k0s(),e.j41(37,"td"),e.EFF(38),e.k0s()()()(),e.j41(39,"div",29)(40,"h6"),e.EFF(41,"Members"),e.k0s(),e.j41(42,"div",91),e.DNE(43,y,7,3,"div",92)(44,N,2,0,"div",93),e.k0s()()()(),e.j41(45,"div",94)(46,"button",95),e.EFF(47,"Close"),e.k0s()()()()()),2&r){const t=e.XpG();e.R7$(6),e.SpI("",t.selectedGroup.groupName," "),e.R7$(12),e.JRh(t.selectedGroup.groupName),e.R7$(5),e.JRh(t.selectedGroup.description||"No description"),e.R7$(5),e.JRh(t.selectedGroup.createdByUserName),e.R7$(5),e.JRh(t.formatDate(t.selectedGroup.createdAt)),e.R7$(5),e.JRh(t.selectedGroup.memberCount),e.R7$(5),e.Y8G("ngForOf",t.selectedGroup.members),e.R7$(),e.Y8G("ngIf",0===t.selectedGroup.members.length)}}let $=(()=>{class r{constructor(t,s){this.fb=t,this.adminService=s,this.groups=[],this.filteredGroups=[],this.availableUsers=[],this.selectedGroup=null,this.isLoading=!1,this.isCreating=!1,this.isProcessing=[],this.showCreateForm=!1,this.successMessage="",this.errorMessage="",this.searchTerm="",this.selectedMemberIds=[],this.createGroupForm=this.fb.group({groupName:["",[i.k0.required,i.k0.maxLength(100)]],description:["",i.k0.maxLength(500)]})}ngOnInit(){this.loadGroups(),this.loadUsers(),console.log("Group management component initialized")}loadGroups(){this.isLoading=!0,this.errorMessage="",this.adminService.getGroups(1,100).subscribe({next:t=>{this.groups=t,this.filterGroups(),this.isLoading=!1,this.initializeProcessingArray()},error:t=>{this.isLoading=!1,this.errorMessage="Failed to load groups. Please try again.",console.error("Error loading groups:",t)}})}loadUsers(){console.log("Loading users for group creation..."),this.adminService.getUsers(1,1e3).subscribe({next:t=>{console.log("Raw users received:",t.length),this.availableUsers=t.filter(s=>!0===s.isActive).map(s=>({id:s.id,userName:s.userName,email:s.email,firstName:s.firstName,lastName:s.lastName,fullName:`${s.firstName||""} ${s.lastName||""}`.trim()||s.userName,isActive:s.isActive})),console.log("Active users loaded for group creation:",this.availableUsers.length),console.log("Available users:",this.availableUsers.map(s=>({id:s.id,name:s.fullName,active:s.isActive}))),console.log("selectedMemberIds after loading users:",this.selectedMemberIds)},error:t=>{console.error("Error loading users:",t),this.errorMessage="Failed to load users for group creation.",this.availableUsers=[]}})}trackByUserId(t,s){return s.id}initializeProcessingArray(){this.isProcessing=new Array(this.groups.length).fill(!1)}filterGroups(){this.filteredGroups=this.groups.filter(t=>!this.searchTerm||t.groupName.toLowerCase().includes(this.searchTerm.toLowerCase())||t.description&&t.description.toLowerCase().includes(this.searchTerm.toLowerCase()))}onMemberSelectionChange(t,s){if(console.log("=== Member Selection Change ==="),console.log("User ID:",s),console.log("Checked:",t.target.checked),console.log("Current selectedMemberIds before change:",this.selectedMemberIds),t.target.checked)this.selectedMemberIds.includes(s)?console.log("User already selected"):(this.selectedMemberIds.push(s),console.log("Added user to selection"));else{const o=this.selectedMemberIds.indexOf(s);o>-1?(this.selectedMemberIds.splice(o,1),console.log("Removed user from selection")):console.log("User was not in selection")}console.log("Selected member IDs after change:",this.selectedMemberIds),console.log("Total selected:",this.selectedMemberIds.length),console.log("===============================")}createGroup(){if(this.createGroupForm.invalid)return;this.isCreating=!0,this.errorMessage="",this.successMessage="";const t={groupName:this.createGroupForm.get("groupName")?.value,description:this.createGroupForm.get("description")?.value,memberIds:this.selectedMemberIds};if(console.log("Creating group with data:",JSON.stringify(t,null,2)),console.log("Selected member IDs:",this.selectedMemberIds),console.log("Member IDs type:",typeof this.selectedMemberIds),console.log("Is array?",Array.isArray(this.selectedMemberIds)),!t.groupName||""===t.groupName.trim())return this.errorMessage="Group name is required",void(this.isCreating=!1);this.selectedGroup&&this.selectedGroup.groupId?(console.log("Updating group with ID:",this.selectedGroup.groupId,"and data:",t),this.adminService.updateGroup(this.selectedGroup.groupId,t).subscribe({next:s=>{console.log("Group updated successfully:",s),this.isCreating=!1,this.successMessage="Group updated successfully!",this.cancelCreate(),this.loadGroups()},error:s=>{this.isCreating=!1,console.error("Full error object:",s),console.error("Error status:",s.status),console.error("Error message:",s.message),console.error("Error details:",s.error),this.errorMessage=400===s.status?"Invalid data provided. Please check your selections.":404===s.status?"Group not found. It may have been deleted.":500===s.status?"Server error occurred. Please try again later.":s.error?.message||"Failed to update group. Please try again."}})):this.adminService.createGroup(t).subscribe({next:s=>{console.log("Group created successfully:",s),this.isCreating=!1,this.successMessage="Group created successfully!",this.cancelCreate(),this.loadGroups()},error:s=>{this.isCreating=!1,this.errorMessage=s.error?.message||"An error occurred while creating the group",console.error("Error creating group:",s),console.error("Error details:",s.error)}})}cancelCreate(){this.showCreateForm=!1,this.createGroupForm.reset(),this.selectedMemberIds=[],this.selectedGroup=null,this.errorMessage="",this.successMessage="",console.log("Form cancelled, selectedMemberIds cleared:",this.selectedMemberIds)}viewGroup(t){this.selectedGroup=t;const s=document.getElementById("groupDetailsModal");s&&new window.bootstrap.Modal(s).show()}editGroup(t){this.selectedGroup=t,this.showCreateForm=!0,this.errorMessage="",this.successMessage="",this.createGroupForm.patchValue({groupName:t.groupName,description:t.description||""}),this.selectedMemberIds=t.members?t.members.map(s=>s.id):[],console.log("Editing group:",t.groupName,"with members:",this.selectedMemberIds)}deleteGroup(t,s){confirm(`Are you sure you want to delete the group "${t.groupName}"? This action cannot be undone.`)&&(this.isProcessing[s]=!0,this.errorMessage="",this.successMessage="",this.adminService.deleteGroup(t.groupId).subscribe({next:()=>{this.isProcessing[s]=!1,this.successMessage="Group deleted successfully!";const o=this.groups.findIndex(a=>a.groupId===t.groupId);o>-1&&(this.groups.splice(o,1),this.filterGroups())},error:o=>{this.isProcessing[s]=!1,this.errorMessage=o.error?.message||"Failed to delete group. Please try again.",console.error("Error deleting group:",o)}}))}formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"}static{this.\u0275fac=function(s){return new(s||r)(e.rXU(i.ok),e.rXU(u.z))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-group-management"]],standalone:!0,features:[e.aNF],decls:29,vars:8,consts:[[1,"container","mt-4"],[1,"row","justify-content-center"],[1,"col-lg-12"],[1,"card","shadow-sm"],[1,"card-header","bg-primary","text-white","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"fas","fa-users-cog","me-2"],[1,"btn","btn-warning","btn-sm",3,"click"],[1,"fas","fa-plus","me-2"],[1,"card-body"],["class","card mb-4",4,"ngIf"],[1,"row","mb-4"],[1,"col-md-8"],[1,"input-group"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text","placeholder","Search groups by name...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"col-md-4"],[1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-sync-alt","me-2"],["class","text-center py-5",4,"ngIf"],["class","row",4,"ngIf"],["class","alert alert-success alert-dismissible fade show",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show",4,"ngIf"],["class","modal fade","id","groupDetailsModal","tabindex","-1",4,"ngIf"],[1,"card","mb-4"],[1,"card-header"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","groupName","placeholder","Enter group name",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["formControlName","description","rows","3","placeholder","Enter group description",1,"form-control"],["class","text-muted",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"d-flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-save me-2",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"invalid-feedback"],["class","col-md-6",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","id","value","checked"],[1,"form-check-label",3,"for"],[1,"text-muted"],[1,"d-flex","align-items-center"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"mt-2"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-save","me-2"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-info"],[1,"visually-hidden"],[1,"mt-2","text-muted"],["class","col-lg-6 mb-4",4,"ngFor","ngForOf"],[1,"col-lg-6","mb-4"],[1,"card","h-100"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"btn-group","btn-group-sm"],["title","View Details",1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-eye"],["title","Edit Group",1,"btn","btn-outline-warning",3,"click"],[1,"fas","fa-edit"],["title","Delete Group",1,"btn","btn-outline-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm",4,"ngIf"],["class","fas fa-trash",4,"ngIf"],[1,"text-muted","mb-2"],[1,"d-flex","justify-content-between","align-items-center"],[1,"fas","fa-users","me-1"],[1,"fas","fa-user","me-1"],[1,"spinner-border","spinner-border-sm"],[1,"fas","fa-trash"],[1,"fas","fa-users-slash","fa-4x","text-muted","mb-3"],[1,"alert","alert-success","alert-dismissible","fade","show"],[1,"fas","fa-check-circle","me-2"],["type","button",1,"btn-close",3,"click"],[1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"fas","fa-exclamation-triangle","me-2"],["id","groupDetailsModal","tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"fas","fa-users","me-2"],["type","button","data-bs-dismiss","modal",1,"btn-close"],[1,"modal-body"],[1,"table","table-borderless"],["width","40%"],[1,"list-group",2,"max-height","300px","overflow-y","auto"],["class","list-group-item",4,"ngFor","ngForOf"],["class","text-muted text-center py-3",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"list-group-item"],[1,"fw-medium"],[1,"text-muted","text-center","py-3"]],template:function(s,o){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),e.nrm(6,"i",6),e.EFF(7,"Group Management "),e.k0s(),e.j41(8,"button",7),e.bIt("click",function(){return o.showCreateForm=!o.showCreateForm}),e.nrm(9,"i",8),e.EFF(10,"Create Group "),e.k0s()(),e.j41(11,"div",9),e.DNE(12,G,31,10,"div",10),e.j41(13,"div",11)(14,"div",12)(15,"div",13)(16,"span",14),e.nrm(17,"i",15),e.k0s(),e.j41(18,"input",16),e.mxI("ngModelChange",function(l){return e.DH7(o.searchTerm,l)||(o.searchTerm=l),l}),e.bIt("input",function(){return o.filterGroups()}),e.k0s()()(),e.j41(19,"div",17)(20,"button",18),e.bIt("click",function(){return o.loadGroups()}),e.nrm(21,"i",19),e.EFF(22,"Refresh "),e.k0s()()(),e.DNE(23,M,6,0,"div",20)(24,I,2,1,"div",21)(25,j,6,0,"div",20)(26,E,4,1,"div",22)(27,R,4,1,"div",23),e.k0s()()()()(),e.DNE(28,x,48,8,"div",24)),2&s&&(e.R7$(12),e.Y8G("ngIf",o.showCreateForm),e.R7$(6),e.R50("ngModel",o.searchTerm),e.R7$(5),e.Y8G("ngIf",o.isLoading),e.R7$(),e.Y8G("ngIf",!o.isLoading&&o.filteredGroups.length>0),e.R7$(),e.Y8G("ngIf",!o.isLoading&&0===o.filteredGroups.length),e.R7$(),e.Y8G("ngIf",o.successMessage),e.R7$(),e.Y8G("ngIf",o.errorMessage),e.R7$(),e.Y8G("ngIf",o.selectedGroup))},dependencies:[d.MD,d.Sq,d.bT,i.X1,i.qT,i.me,i.BC,i.cb,i.j4,i.JD,i.YN,i.vS],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem}.form-check[_ngcontent-%COMP%]{margin-bottom:.5rem}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:0 1rem}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.125rem .25rem}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}}"]})}}return r})()}}]);