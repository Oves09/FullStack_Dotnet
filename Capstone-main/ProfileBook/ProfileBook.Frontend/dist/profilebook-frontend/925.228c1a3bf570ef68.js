"use strict";(self.webpackChunkprofilebook_frontend=self.webpackChunkprofilebook_frontend||[]).push([[925],{8925:(j,d,p)=>{p.r(d),p.d(d,{PostApprovalComponent:()=>A});var l=p(177),a=p(4341),s=p(4438),g=p(7945);function f(i,n){1&i&&(s.j41(0,"div",12)(1,"div",13)(2,"span",14),s.EFF(3,"Loading pending posts..."),s.k0s()(),s.j41(4,"p",15),s.EFF(5,"Loading posts for review..."),s.k0s()())}function _(i,n){if(1&i){const e=s.RV6();s.j41(0,"div",12),s.nrm(1,"i",16),s.j41(2,"h5",17),s.EFF(3,"All caught up!"),s.k0s(),s.j41(4,"p",17),s.EFF(5,"There are no posts pending approval at the moment."),s.k0s(),s.j41(6,"button",18),s.bIt("click",function(){s.eBV(e);const t=s.XpG();return s.Njj(t.loadPosts())}),s.nrm(7,"i",19),s.EFF(8,"Refresh "),s.k0s()()}}function u(i,n){if(1&i&&s.nrm(0,"img",43),2&i){const e=s.XpG().$implicit;s.Y8G("src",e.postImagePath,s.B4B)}}function v(i,n){1&i&&s.nrm(0,"span",44)}function h(i,n){1&i&&s.nrm(0,"i",45)}function b(i,n){1&i&&s.nrm(0,"span",44)}function P(i,n){1&i&&s.nrm(0,"i",46)}function F(i,n){if(1&i){const e=s.RV6();s.j41(0,"div",22)(1,"div",7)(2,"div",23),s.nrm(3,"img",24),s.j41(4,"div",25)(5,"h6",26),s.EFF(6),s.k0s(),s.j41(7,"small",17),s.EFF(8),s.k0s()(),s.j41(9,"span",27),s.nrm(10,"i",28),s.EFF(11,"Pending Review "),s.k0s()(),s.j41(12,"div",29)(13,"p",30),s.EFF(14),s.k0s(),s.DNE(15,u,1,1,"img",31),s.k0s(),s.j41(16,"div",32)(17,"form",33),s.bIt("ngSubmit",function(){const t=s.eBV(e),r=t.$implicit,c=t.index,m=s.XpG(2);return s.Njj(m.approvePost(r,c,!0))}),s.j41(18,"div",34)(19,"label",35),s.EFF(20,"Admin Comments (Optional)"),s.k0s(),s.nrm(21,"textarea",36),s.k0s(),s.j41(22,"div",37)(23,"button",38),s.DNE(24,v,1,0,"span",39)(25,h,1,0,"i",40),s.EFF(26),s.k0s(),s.j41(27,"button",41),s.bIt("click",function(){const t=s.eBV(e),r=t.$implicit,c=t.index,m=s.XpG(2);return s.Njj(m.approvePost(r,c,!1))}),s.DNE(28,b,1,0,"span",39)(29,P,1,0,"i",42),s.EFF(30),s.k0s()()()()()()}if(2&i){const e=n.$implicit,o=n.index,t=s.XpG(2);s.R7$(3),s.Y8G("src",t.getPostUserAvatar(e),s.B4B),s.R7$(3),s.JRh(e.userFullName),s.R7$(2),s.Lme("","@"+e.userName," \u2022 ",t.formatDate(e.createdAt),""),s.R7$(6),s.JRh(e.content),s.R7$(),s.Y8G("ngIf",e.postImagePath),s.R7$(2),s.Y8G("formGroup",t.getApprovalForm(o)),s.R7$(6),s.Y8G("disabled",t.isProcessing[o]),s.R7$(),s.Y8G("ngIf",t.isProcessing[o]),s.R7$(),s.Y8G("ngIf",!t.isProcessing[o]),s.R7$(),s.SpI(" ",t.isProcessing[o]?"Approving...":"Approve"," "),s.R7$(),s.Y8G("disabled",t.isProcessing[o]),s.R7$(),s.Y8G("ngIf",t.isProcessing[o]),s.R7$(),s.Y8G("ngIf",!t.isProcessing[o]),s.R7$(),s.SpI(" ",t.isProcessing[o]?"Rejecting...":"Reject"," ")}}function x(i,n){if(1&i&&(s.j41(0,"div",20),s.DNE(1,F,31,15,"div",21),s.k0s()),2&i){const e=s.XpG();s.R7$(),s.Y8G("ngForOf",e.posts)}}function C(i,n){if(1&i){const e=s.RV6();s.j41(0,"div",47),s.nrm(1,"i",48),s.EFF(2),s.j41(3,"button",49),s.bIt("click",function(){s.eBV(e);const t=s.XpG();return s.Njj(t.successMessage="")}),s.k0s()()}if(2&i){const e=s.XpG();s.R7$(2),s.SpI("",e.successMessage," ")}}function M(i,n){if(1&i){const e=s.RV6();s.j41(0,"div",50),s.nrm(1,"i",51),s.EFF(2),s.j41(3,"button",49),s.bIt("click",function(){s.eBV(e);const t=s.XpG();return s.Njj(t.errorMessage="")}),s.k0s()()}if(2&i){const e=s.XpG();s.R7$(2),s.SpI("",e.errorMessage," ")}}let A=(()=>{class i{constructor(e,o){this.fb=e,this.adminService=o,this.posts=[],this.approvalForms=[],this.isLoading=!1,this.isProcessing=[],this.successMessage="",this.errorMessage=""}ngOnInit(){this.loadPosts()}loadPosts(){this.isLoading=!0,this.errorMessage="",this.adminService.getPendingPosts().subscribe({next:e=>{this.posts=e,this.initializeForms(),this.isLoading=!1},error:e=>{this.isLoading=!1,this.errorMessage=401===e.status?"Authentication failed. Please log in as an admin.":403===e.status?"Access denied. Admin privileges required.":"Failed to load posts. Please try again.",console.error("Error loading posts:",e)}})}initializeForms(){this.approvalForms=[],this.isProcessing=[],this.posts.forEach(()=>{this.approvalForms.push(this.fb.group({adminComments:[""]})),this.isProcessing.push(!1)})}getApprovalForm(e){return this.approvalForms[e]}approvePost(e,o,t){this.isProcessing[o]=!0,this.errorMessage="",this.successMessage="";const r={postId:e.postId,isApproved:t,adminComments:this.approvalForms[o].get("adminComments")?.value||void 0};this.adminService.approvePost(r).subscribe({next:()=>{this.isProcessing[o]=!1,this.successMessage=`Post ${t?"approved":"rejected"} successfully!`,this.posts.splice(o,1),this.approvalForms.splice(o,1),this.isProcessing.splice(o,1)},error:c=>{this.isProcessing[o]=!1,this.errorMessage=401===c.status?"Authentication failed. Please log in as an admin.":403===c.status?"Access denied. Admin privileges required.":c.error?.message||`Failed to ${t?"approve":"reject"} post. Please try again.`,console.error("Error processing post:",c)}})}getPostUserAvatar(e){return e.userProfileImage?e.userProfileImage:"https://via.placeholder.com/48x48/3b82f6/ffffff?text="+(e.userFullName?.charAt(0)||"U")}formatDate(e){const o=new Date(e),r=Math.floor(((new Date).getTime()-o.getTime())/6e4);return r<60?`${r}m ago`:r<1440?`${Math.floor(r/60)}h ago`:r<10080?`${Math.floor(r/1440)}d ago`:o.toLocaleDateString()}static{this.\u0275fac=function(o){return new(o||i)(s.rXU(a.ok),s.rXU(g.z))}}static{this.\u0275cmp=s.VBU({type:i,selectors:[["app-post-approval"]],standalone:!0,features:[s.aNF],decls:14,vars:5,consts:[[1,"container","mt-4"],[1,"row","justify-content-center"],[1,"col-lg-10"],[1,"card","shadow-sm"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"fas","fa-file-alt","me-2"],[1,"card-body"],["class","text-center py-5",4,"ngIf"],["class","posts-list",4,"ngIf"],["class","alert alert-success alert-dismissible fade show",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"fas","fa-check-circle","fa-4x","text-success","mb-3"],[1,"text-muted"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-sync-alt","me-2"],[1,"posts-list"],["class","post-card card mb-4",4,"ngFor","ngForOf"],[1,"post-card","card","mb-4"],[1,"d-flex","align-items-center","mb-3"],["width","48","height","48","alt","User avatar",1,"rounded-circle","me-3",3,"src"],[1,"flex-grow-1"],[1,"mb-1"],[1,"badge","bg-warning"],[1,"fas","fa-clock","me-1"],[1,"post-content","mb-3"],[1,"mb-2"],["class","post-image img-fluid rounded","alt","Post image",3,"src",4,"ngIf"],[1,"approval-section","border-top","pt-3"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["formControlName","adminComments","rows","2","placeholder","Add any comments for the user...",1,"form-control"],[1,"d-flex","gap-2"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-check me-1",4,"ngIf"],["type","button",1,"btn","btn-danger",3,"click","disabled"],["class","fas fa-times me-1",4,"ngIf"],["alt","Post image",1,"post-image","img-fluid","rounded",3,"src"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-check","me-1"],[1,"fas","fa-times","me-1"],[1,"alert","alert-success","alert-dismissible","fade","show"],[1,"fas","fa-check-circle","me-2"],["type","button",1,"btn-close",3,"click"],[1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"fas","fa-exclamation-triangle","me-2"]],template:function(o,t){1&o&&(s.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),s.nrm(6,"i",6),s.EFF(7,"Post Approval Management "),s.k0s()(),s.j41(8,"div",7),s.DNE(9,f,6,0,"div",8)(10,_,9,0,"div",8)(11,x,2,1,"div",9)(12,C,4,1,"div",10)(13,M,4,1,"div",11),s.k0s()()()()()),2&o&&(s.R7$(9),s.Y8G("ngIf",t.isLoading),s.R7$(),s.Y8G("ngIf",!t.isLoading&&0===t.posts.length),s.R7$(),s.Y8G("ngIf",!t.isLoading&&t.posts.length>0),s.R7$(),s.Y8G("ngIf",t.successMessage),s.R7$(),s.Y8G("ngIf",t.errorMessage))},dependencies:[l.MD,l.Sq,l.bT,a.X1,a.qT,a.me,a.BC,a.cb,a.j4,a.JD],styles:[".post-card[_ngcontent-%COMP%]{border:none;box-shadow:0 2px 4px #0000001a;transition:transform .2s ease,box-shadow .2s ease}.post-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #00000026}.post-image[_ngcontent-%COMP%]{max-height:300px;object-fit:cover;width:100%}.approval-section[_ngcontent-%COMP%]{background-color:var(--light-bg);margin:-1rem -1rem 0;padding:1rem;border-radius:0 0 .75rem .75rem}.badge[_ngcontent-%COMP%]{font-size:.875rem;padding:.5rem .75rem}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:0 1rem}.d-flex.gap-2[_ngcontent-%COMP%]{flex-direction:column}.d-flex.gap-2[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:.5rem}}"]})}}return i})()}}]);