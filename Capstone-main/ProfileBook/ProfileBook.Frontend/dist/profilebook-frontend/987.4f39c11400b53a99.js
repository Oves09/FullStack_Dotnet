"use strict";(self.webpackChunkprofilebook_frontend=self.webpackChunkprofilebook_frontend||[]).push([[987],{5987:(E,l,c)=>{c.r(l),c.d(l,{FeedComponent:()=>$});var m=c(177),a=c(4341),e=c(4438),d=c(1032),p=c(4796);function g(o,i){1&o&&(e.j41(0,"div",29),e.EFF(1," Post content is required and must be less than 2000 characters "),e.k0s())}function _(o,i){if(1&o){const t=e.RV6();e.j41(0,"div",30)(1,"div",31),e.nrm(2,"img",32),e.j41(3,"button",33),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.removeImage())}),e.nrm(4,"i",34),e.k0s()()()}if(2&o){const t=e.XpG(2);e.R7$(2),e.Y8G("src",t.selectedImage,e.B4B)}}function u(o,i){1&o&&e.nrm(0,"span",35)}function f(o,i){1&o&&e.nrm(0,"i",36)}function h(o,i){if(1&o){const t=e.RV6();e.j41(0,"div",10)(1,"div",11)(2,"h5",12),e.nrm(3,"i",13),e.EFF(4,"Create New Post "),e.k0s()(),e.j41(5,"div",14)(6,"form",15),e.bIt("ngSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.onCreatePost())}),e.j41(7,"div",16),e.nrm(8,"img",17),e.j41(9,"div",18),e.nrm(10,"textarea",19),e.DNE(11,g,2,0,"div",20),e.k0s()(),e.DNE(12,_,5,1,"div",21),e.j41(13,"div",22)(14,"div")(15,"input",23,0),e.bIt("change",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.onImageSelected(s))}),e.k0s(),e.j41(17,"button",24),e.bIt("click",function(){e.eBV(t);const s=e.sdS(16);return e.Njj(s.click())}),e.nrm(18,"i",25),e.EFF(19,"Add Photo "),e.k0s()(),e.j41(20,"button",26),e.DNE(21,u,1,0,"span",27)(22,f,1,0,"i",28),e.EFF(23),e.k0s()()()()()}if(2&o){const t=e.XpG();e.R7$(6),e.Y8G("formGroup",t.postForm),e.R7$(2),e.Y8G("src",t.getUserAvatar(),e.B4B),e.R7$(2),e.AVh("is-invalid",t.isFieldInvalid("content")),e.Mz_("placeholder","What's on your mind, ",null==t.currentUser?null:t.currentUser.firstName,"?"),e.R7$(),e.Y8G("ngIf",t.isFieldInvalid("content")),e.R7$(),e.Y8G("ngIf",t.selectedImage),e.R7$(8),e.Y8G("disabled",t.postForm.invalid||t.isCreatingPost),e.R7$(),e.Y8G("ngIf",t.isCreatingPost),e.R7$(),e.Y8G("ngIf",!t.isCreatingPost),e.R7$(),e.SpI(" ",t.isCreatingPost?"Posting...":"Post"," ")}}function v(o,i){if(1&o){const t=e.RV6();e.j41(0,"div",37),e.nrm(1,"i",38),e.EFF(2),e.j41(3,"button",39),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.successMessage="")}),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(2),e.SpI("",t.successMessage," ")}}function b(o,i){if(1&o){const t=e.RV6();e.j41(0,"div",40),e.nrm(1,"i",41),e.EFF(2),e.j41(3,"button",39),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.errorMessage="")}),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(2),e.SpI("",t.errorMessage," ")}}function C(o,i){1&o&&(e.j41(0,"div",42)(1,"div",43)(2,"span",44),e.EFF(3,"Loading posts..."),e.k0s()(),e.j41(4,"p",45),e.EFF(5,"Loading posts..."),e.k0s()())}function F(o,i){1&o&&(e.j41(0,"div",42),e.nrm(1,"i",46),e.j41(2,"h4",47),e.EFF(3,"No posts yet"),e.k0s(),e.j41(4,"p",47),e.EFF(5,"Be the first to share something with the community!"),e.k0s()())}function P(o,i){if(1&o&&e.nrm(0,"img",61),2&o){const t=e.XpG().$implicit,n=e.XpG();e.Y8G("src",n.getFullImageUrl(t.postImagePath),e.B4B)}}function k(o,i){if(1&o&&(e.j41(0,"div",74)(1,"div",64),e.nrm(2,"img",75),e.j41(3,"div",18)(4,"div",76)(5,"strong"),e.EFF(6),e.k0s(),e.j41(7,"span",77),e.EFF(8),e.k0s(),e.j41(9,"p",78),e.EFF(10),e.k0s()()()()()),2&o){const t=i.$implicit,n=e.XpG(4);e.R7$(2),e.Y8G("src",n.getCommentUserAvatar(t),e.B4B),e.R7$(4),e.JRh(t.userFullName),e.R7$(2),e.JRh(n.formatDate(t.createdAt)),e.R7$(2),e.JRh(t.content)}}function x(o,i){if(1&o&&(e.j41(0,"div",72),e.DNE(1,k,11,4,"div",73),e.k0s()),2&o){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngForOf",t.comments)}}function I(o,i){1&o&&(e.j41(0,"div",79)(1,"p",47),e.EFF(2,"No comments yet. Be the first to comment!"),e.k0s()())}function M(o,i){if(1&o){const t=e.RV6();e.j41(0,"div",62)(1,"div",63)(2,"div",64),e.nrm(3,"img",65),e.j41(4,"div",18)(5,"div",66)(6,"input",67),e.mxI("ngModelChange",function(s){e.eBV(t);const r=e.XpG().$implicit;return e.DH7(r.newComment,s)||(r.newComment=s),e.Njj(s)}),e.bIt("keyup.enter",function(){e.eBV(t);const s=e.XpG().$implicit,r=e.XpG();return e.Njj(r.addComment(s))}),e.k0s(),e.j41(7,"button",68),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,r=e.XpG();return e.Njj(r.addComment(s))}),e.nrm(8,"i",69),e.k0s()()()()(),e.DNE(9,x,2,1,"div",70)(10,I,3,0,"div",71),e.k0s()}if(2&o){const t=e.XpG().$implicit,n=e.XpG();e.R7$(3),e.Y8G("src",n.getUserAvatar(),e.B4B),e.R7$(3),e.R50("ngModel",t.newComment),e.R7$(),e.Y8G("disabled",!(null!=t.newComment&&t.newComment.trim())),e.R7$(2),e.Y8G("ngIf",t.comments&&t.comments.length>0),e.R7$(),e.Y8G("ngIf",t.showComments&&(!t.comments||0===t.comments.length))}}function j(o,i){if(1&o){const t=e.RV6();e.j41(0,"div",48)(1,"div",14)(2,"div",49),e.nrm(3,"img",50),e.j41(4,"div",51)(5,"h6",52),e.EFF(6),e.k0s(),e.j41(7,"p",53),e.EFF(8),e.k0s()()(),e.j41(9,"div",54)(10,"p"),e.EFF(11),e.k0s(),e.DNE(12,P,1,1,"img",55),e.k0s(),e.j41(13,"div",56)(14,"button",57),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.toggleLike(s))}),e.nrm(15,"i",58),e.EFF(16),e.k0s(),e.j41(17,"button",57),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.toggleComments(s))}),e.nrm(18,"i",59),e.EFF(19),e.k0s()(),e.DNE(20,M,11,5,"div",60),e.k0s()()}if(2&o){const t=i.$implicit,n=e.XpG();e.R7$(3),e.Y8G("src",n.getPostUserAvatar(t),e.B4B),e.R7$(3),e.JRh(t.userFullName),e.R7$(2),e.JRh(n.formatDate(t.createdAt)),e.R7$(3),e.JRh(t.content),e.R7$(),e.Y8G("ngIf",t.postImagePath),e.R7$(2),e.AVh("liked",t.isLikedByCurrentUser),e.R7$(2),e.Lme(" ",t.likesCount," ",1===t.likesCount?"Like":"Likes"," "),e.R7$(3),e.Lme(" ",t.commentsCount," ",1===t.commentsCount?"Comment":"Comments"," "),e.R7$(),e.Y8G("ngIf",t.showComments)}}function R(o,i){1&o&&e.nrm(0,"span",35)}function G(o,i){if(1&o){const t=e.RV6();e.j41(0,"div",80)(1,"button",81),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.loadMorePosts())}),e.DNE(2,R,1,0,"span",27),e.EFF(3),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(),e.Y8G("disabled",t.isLoadingMore),e.R7$(),e.Y8G("ngIf",t.isLoadingMore),e.R7$(),e.SpI(" ",t.isLoadingMore?"Loading...":"Load More Posts"," ")}}let $=(()=>{class o{constructor(t,n,s){this.fb=t,this.postService=n,this.authService=s,this.posts=[],this.currentUser=null,this.isLoadingPosts=!1,this.isCreatingPost=!1,this.isLoadingMore=!1,this.hasMorePosts=!0,this.currentPage=1,this.pageSize=10,this.selectedImage=null,this.selectedFile=null,this.successMessage="",this.errorMessage="",this.postForm=this.fb.group({content:["",[a.k0.required,a.k0.maxLength(2e3)]]})}ngOnInit(){this.authService.currentUser$.subscribe(t=>{this.currentUser=t}),this.loadPosts()}loadPosts(){this.isLoadingPosts=!0,this.postService.getPosts(1,this.pageSize).subscribe({next:t=>{this.posts=t,this.isLoadingPosts=!1,this.hasMorePosts=t.length===this.pageSize,this.currentPage=1},error:t=>{this.isLoadingPosts=!1,this.errorMessage="Failed to load posts. Please try again.",console.error("Error loading posts:",t)}})}loadMorePosts(){this.isLoadingMore=!0;const t=this.currentPage+1;this.postService.getPosts(t,this.pageSize).subscribe({next:n=>{this.posts.push(...n),this.isLoadingMore=!1,this.hasMorePosts=n.length===this.pageSize,this.currentPage=t},error:n=>{this.isLoadingMore=!1,this.errorMessage="Failed to load more posts. Please try again.",console.error("Error loading more posts:",n)}})}onCreatePost(){if(this.postForm.valid){this.isCreatingPost=!0,this.errorMessage="";const t={content:this.postForm.get("content")?.value,postImage:this.selectedFile||void 0};this.postService.createPost(t).subscribe({next:n=>{this.isCreatingPost=!1,this.successMessage="Post created successfully! It will be visible after admin approval.",this.postForm.reset(),this.removeImage()},error:n=>{this.isCreatingPost=!1,this.errorMessage=n.error?.message||"Failed to create post. Please try again.",console.error("Error creating post:",n)}})}else this.markFormGroupTouched()}onImageSelected(t){const n=t.target.files[0];if(n){this.selectedFile=n;const s=new FileReader;s.onload=r=>{this.selectedImage=r.target.result},s.readAsDataURL(n)}}removeImage(){this.selectedImage=null,this.selectedFile=null}toggleLike(t){this.postService.likePost(t.postId).subscribe({next:()=>{t.isLikedByCurrentUser=!t.isLikedByCurrentUser,t.likesCount+=t.isLikedByCurrentUser?1:-1},error:n=>{this.errorMessage="Failed to update like. Please try again.",console.error("Error toggling like:",n)}})}getUserAvatar(){return this.currentUser?.profileImagePath?this.getFullImageUrl(this.currentUser.profileImagePath):"https://via.placeholder.com/48x48/3b82f6/ffffff?text="+(this.currentUser?.firstName?.charAt(0)||this.currentUser?.userName?.charAt(0)||"U")}getPostUserAvatar(t){return t.userProfileImage?this.getFullImageUrl(t.userProfileImage):"https://via.placeholder.com/48x48/3b82f6/ffffff?text="+(t.userFullName?.charAt(0)||"U")}getFullImageUrl(t){return t?t.startsWith("http")?t:`http://localhost:5120${t}`:""}formatDate(t){const n=new Date,s=new Date(t),r=Math.floor((n.getTime()-s.getTime())/6e4);return r<1?"Just now":r<60?`${r}m ago`:r<1440?`${Math.floor(r/60)}h ago`:r<10080?`${Math.floor(r/1440)}d ago`:s.toLocaleDateString()}isFieldInvalid(t){const n=this.postForm.get(t);return!(!n||!n.invalid||!n.dirty&&!n.touched)}toggleComments(t){t.showComments=!t.showComments,t.showComments&&!t.comments&&this.loadComments(t)}loadComments(t){this.postService.getComments(t.postId).subscribe({next:n=>{t.comments=n},error:n=>{this.errorMessage="Failed to load comments. Please try again.",console.error("Error loading comments:",n)}})}addComment(t){if(!t.newComment?.trim())return;const n=t.newComment.trim();t.newComment="",this.postService.addComment(t.postId,n).subscribe({next:s=>{t.comments||(t.comments=[]),t.comments.unshift(s),t.commentsCount++},error:s=>{this.errorMessage="Failed to add comment. Please try again.",console.error("Error adding comment:",s),t.newComment=n}})}getCommentUserAvatar(t){return t.userProfileImage?this.getFullImageUrl(t.userProfileImage):"https://via.placeholder.com/32x32/3b82f6/ffffff?text="+(t.userFullName?.charAt(0)||"U")}markFormGroupTouched(){Object.keys(this.postForm.controls).forEach(t=>{this.postForm.get(t)?.markAsTouched()})}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(a.ok),e.rXU(d.K),e.rXU(p.u))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-feed"]],standalone:!0,features:[e.aNF],decls:10,vars:7,consts:[["fileInput",""],[1,"container","mt-4"],[1,"row"],[1,"col-lg-8","mx-auto"],["class","card mb-4",4,"ngIf"],["class","alert alert-success alert-dismissible fade show",4,"ngIf"],["class","alert alert-danger alert-dismissible fade show",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","post-card card",4,"ngFor","ngForOf"],["class","text-center mt-4",4,"ngIf"],[1,"card","mb-4"],[1,"card-header"],[1,"mb-0"],[1,"fas","fa-plus-circle","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"d-flex","mb-3"],["width","48","height","48","alt","Your avatar",1,"rounded-circle","me-3",3,"src"],[1,"flex-grow-1"],["formControlName","content","rows","3",1,"form-control",3,"placeholder"],["class","invalid-feedback",4,"ngIf"],["class","mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center"],["type","file","accept","image/*",1,"d-none",3,"change"],["type","button",1,"btn","btn-outline-primary","btn-sm","me-2",3,"click"],[1,"fas","fa-image","me-1"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-paper-plane me-1",4,"ngIf"],[1,"invalid-feedback"],[1,"mb-3"],[1,"position-relative","d-inline-block"],["alt","Selected image",1,"img-thumbnail",2,"max-height","200px",3,"src"],["type","button",1,"btn","btn-sm","btn-danger","position-absolute","top-0","end-0",2,"transform","translate(50%, -50%)",3,"click"],[1,"fas","fa-times"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-paper-plane","me-1"],[1,"alert","alert-success","alert-dismissible","fade","show"],[1,"fas","fa-check-circle","me-2"],["type","button",1,"btn-close",3,"click"],[1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"fas","fa-newspaper","fa-3x","text-muted","mb-3"],[1,"text-muted"],[1,"post-card","card"],[1,"post-header"],["alt","User avatar",1,"user-avatar",3,"src"],[1,"user-info"],[1,"user-name"],[1,"post-time"],[1,"post-content"],["class","post-image","alt","Post image",3,"src",4,"ngIf"],[1,"post-actions"],[1,"action-btn",3,"click"],[1,"fas","fa-heart"],[1,"fas","fa-comment"],["class","comments-section",4,"ngIf"],["alt","Post image",1,"post-image",3,"src"],[1,"comments-section"],[1,"comment-form","mt-3"],[1,"d-flex"],["width","32","height","32","alt","Your avatar",1,"rounded-circle","me-2",3,"src"],[1,"input-group"],["type","text","placeholder","Write a comment...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-paper-plane"],["class","comments-list mt-3",4,"ngIf"],["class","text-center mt-2",4,"ngIf"],[1,"comments-list","mt-3"],["class","comment",4,"ngFor","ngForOf"],[1,"comment"],["width","32","height","32","alt","User avatar",1,"rounded-circle","me-2",3,"src"],[1,"comment-content"],[1,"text-muted","ms-2"],[1,"mb-1"],[1,"text-center","mt-2"],[1,"text-center","mt-4"],[1,"btn","btn-outline-primary",3,"click","disabled"]],template:function(n,s){1&n&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3),e.DNE(3,h,24,12,"div",4)(4,v,4,1,"div",5)(5,b,4,1,"div",6)(6,C,6,0,"div",7)(7,F,6,0,"div",7)(8,j,21,12,"div",8)(9,G,4,3,"div",9),e.k0s()()()),2&n&&(e.R7$(3),e.Y8G("ngIf",s.currentUser),e.R7$(),e.Y8G("ngIf",s.successMessage),e.R7$(),e.Y8G("ngIf",s.errorMessage),e.R7$(),e.Y8G("ngIf",s.isLoadingPosts),e.R7$(),e.Y8G("ngIf",!s.isLoadingPosts&&0===s.posts.length),e.R7$(),e.Y8G("ngForOf",s.posts),e.R7$(),e.Y8G("ngIf",!s.isLoadingPosts&&s.posts.length>0&&s.hasMorePosts))},dependencies:[m.MD,m.Sq,m.bT,a.X1,a.qT,a.me,a.BC,a.cb,a.j4,a.JD,a.YN,a.vS],styles:[".post-card[_ngcontent-%COMP%]{margin-bottom:1.5rem;border:none;box-shadow:0 2px 4px #0000001a;transition:transform .2s ease,box-shadow .2s ease}.post-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #00000026}.post-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1rem}.user-avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;object-fit:cover;margin-right:.75rem}.user-info[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{margin:0;font-weight:600;color:var(--text-primary)}.user-info[_ngcontent-%COMP%]   .post-time[_ngcontent-%COMP%]{margin:0;font-size:.875rem;color:var(--text-secondary)}.post-content[_ngcontent-%COMP%]{margin-bottom:1rem;line-height:1.6}.post-image[_ngcontent-%COMP%]{width:100%;max-height:400px;object-fit:cover;border-radius:.5rem;margin-top:.75rem}.post-actions[_ngcontent-%COMP%]{display:flex;gap:1.5rem;padding-top:.75rem;border-top:1px solid var(--border-color)}.action-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-secondary);font-size:.9rem;cursor:pointer;transition:color .2s ease;padding:.5rem 0}.action-btn[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.action-btn.liked[_ngcontent-%COMP%]{color:var(--danger-color)}.action-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}.img-thumbnail[_ngcontent-%COMP%]{border:2px solid var(--border-color)}.comments-section[_ngcontent-%COMP%]{border-top:1px solid var(--border-color);padding-top:1rem;margin-top:1rem}.comment[_ngcontent-%COMP%]{padding:.5rem 0;border-bottom:1px solid #f0f0f0}.comment[_ngcontent-%COMP%]:last-child{border-bottom:none}.comment-content[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:.5rem .75rem;border-radius:.5rem;margin-top:.25rem}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:0 1rem}.post-actions[_ngcontent-%COMP%]{gap:1rem}.action-btn[_ngcontent-%COMP%]{font-size:.8rem}}"]})}}return o})()}}]);